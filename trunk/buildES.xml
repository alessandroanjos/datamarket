<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="make" name="av">

	<property name="dirDeploy" value="c:\temp" />
	<property name="contexto" value="es" />

	<property name="src" value="src" />
	<property name="conf" value="conf" />
	<property name="lib" value="lib" />
	
	<target depends="renomearDestino,clean,criarDestino,copyAmbienteWeb,recursosConf,recursosSRC,copyLib,gerarJar,compilarJasper" name="make" />

	<target name="renomearDestino" >
		<mkdir dir="${dirDeploy}/${contexto}" />
		<tstamp>
		    <format property="HOJE" pattern="yyyyMMdd_hhmmss" locale="pt,BR"/>
		  </tstamp>
		<move file="${dirDeploy}/${contexto}" todir=".\ES_${HOJE}" />  
	</target>
	
	<target name="clean" >
		<delete dir="${dirDeploy}/${contexto}" />
	</target>

	<target name="criarDestino">
		<mkdir dir="${dirDeploy}/${contexto}" />
		<mkdir dir="${dirDeploy}/${contexto}/bd" />
		<mkdir dir="${dirDeploy}/${contexto}/bd/template" />
		<mkdir dir="${dirDeploy}/${contexto}/WEB-INF" />
		<mkdir dir="${dirDeploy}/${contexto}/WEB-INF/lib" />
		<mkdir dir="${dirDeploy}/${contexto}/WEB-INF/classes" />
		<mkdir dir="${dirDeploy}/${contexto}/WEB-INF/lib" />
	</target>

			
	<target name="recursosSRC">
			<copy todir="${dirDeploy}/${contexto}/WEB-INF/classes">
			<fileset dir="${src}">
				<include name="**/*.au" />
				<include name="**/*.midi" />
				<include name="**/*.gif" />
				<include name="**/*.xml" />
				<include name="**/*.properties" />
				<include name="**/*.aiff" />
				<include name="**/*.jpe" />
				<include name="**/*.jpeg" />
				<include name="**/*.rmf" />
				<include name="**/*.wav" />
				<include name="**/*.mid" />
				<include name="**/*.png" />
				<include name="**/*.jpg" />
				<include name="**/*.swf" />
				<include name="**/*.jasper" />
				<exclude name="**/*.hbm.xml" />
			</fileset>
		</copy>
	</target>

	<target name="recursosConf">
		<copy todir="${dirDeploy}/${contexto}/WEB-INF/classes">
			<fileset dir="${conf}">
				<include name="**/*.au" />
				<include name="**/*.midi" />
				<include name="**/*.gif" />
				<include name="**/*.xml" />
				<include name="**/*.properties" />
				<include name="**/*.aiff" />
				<include name="**/*.jpe" />
				<include name="**/*.jpeg" />
				<include name="**/*.rmf" />
				<include name="**/*.wav" />
				<include name="**/*.mid" />
				<include name="**/*.png" />
				<include name="**/*.jpg" />
				<include name="**/*.swf" />
				<include name="**/*.jasper" />
			</fileset>
		</copy>
	</target>

	<target name="copyLibJboss">
		<copy todir="${dirDeploy}/${contexto}/WEB-INF/lib">
			<fileset dir="WebResources/WEB-INF/libJboss">
			</fileset>
		</copy>
	</target>

	<target depends="copyLibJboss" name="copyLib">
		<copy todir="${dirDeploy}/${contexto}/WEB-INF/lib">
			<fileset dir="WebResources/WEB-INF/lib">
			</fileset>
		</copy>
	</target>

	<target name="compilarJasper" description="Compilar os RelatÃ³rios">
		<mkdir dir="${dirDeploy}/${contexto}/WEB-INF/classes" />
		<delete>
			<fileset dir="src/resources">
				<exclude name="*.jrxml"/>
			</fileset>
		</delete>

		<taskdef name="jrc" classname="net.sf.jasperreports.ant.JRAntCompileTask">
			<classpath>
				<fileset dir="${dirDeploy}/${contexto}/WEB-INF/lib">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${dirDeploy}/${contexto}/WEB-INF/classes">
					<include name="classes**/*.class" />
				</fileset>
			</classpath>
		</taskdef>

		<jrc srcdir="src/resources" destdir="${dirDeploy}/${contexto}/WEB-INF/classes/resources" tempdir="${dirDeploy}/${contexto}/WEB-INF/classes/resources" keepjava="false">
			<classpath>
				<fileset dir="${dirDeploy}/${contexto}/WEB-INF/lib">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</jrc>
	</target>

	<target depends="compilar" name="gerarJar">
        <jar destfile="${dirDeploy}/${contexto}/WEB-INF/lib/es.jar" basedir="${dirDeploy}/${contexto}/WEB-INF/classes" />
    </target>
	
<target name="compilar">
        <mkdir dir=""/>
		<javac srcdir="${src}" destdir="${dirDeploy}/${contexto}/WEB-INF/classes" classpathref="classpath"/>
	</target>

	<target name="copyAmbienteWeb">
		<copy todir="${dirDeploy}/${contexto}">
			<fileset dir="WebResources">
				<exclude name="WebResources/WEB-INF/classes**/*.*" />
			</fileset>
		</copy>
	</target>
	
	
	<path id="classpath">
        <fileset dir="${dirDeploy}/${contexto}/WEB-INF/lib" includes="**/*.jar"/>
	    </path>
	
	<target name="init">
	</target>
</project>